{% extends 'base.html' %}
{% load static %}

{% block title %}{{ portfolio.name }} | –î–µ—Ç–∞–ª—ñ{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/portfolio_detail.css' %}">
{% endblock %}

{% block content %}
<div class="container py-4">
    
    <a href="{% url 'home' %}" class="back-link">‚Üê –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>

    <div class="portfolio-header-card">
        <div class="d-flex justify-content-between align-items-start mb-4 relative-z">
            <div>
                <h1 class="portfolio-name">{{ portfolio.name }}</h1>
                <div class="portfolio-total">
                    {{ portfolio.get_total_balance|floatformat:2 }} <span class="fs-4">‚Ç¥</span>
                </div>
            </div>
            
            <div class="header-actions d-flex align-items-center gap-2">
                <button type="button" 
                        class="btn btn-glass-icon" 
                        data-bs-toggle="modal" 
                        data-bs-target="#editPortfolioModal" 
                        title="–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ—Ä—Ç—Ñ–æ–ª—ñ–æ">
                    ‚öôÔ∏è
                </button>

                <button type="button" 
                        class="btn btn-glass-icon" 
                        style="width: auto; padding: 0 15px; font-size: 1.2rem;"
                        data-bs-toggle="modal" 
                        data-bs-target="#addTransferModal"
                        title="–ó—Ä–æ–±–∏—Ç–∏ –ø–µ—Ä–µ–∫–∞–∑">
                    ‚áÑ
                </button>
                
                <button type="button" 
                        class="btn btn-primary shadow-lg" 
                        data-bs-toggle="modal" 
                        data-bs-target="#addTransactionModal">
                    + –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è
                </button>
            </div>
        </div>

        <div class="mini-assets-grid">
            {% for item in portfolio.items.all %}
            <div class="mini-asset-card">
                <div class="d-flex align-items-center mb-2">
                    <div class="tx-icon" style="width: 32px; height: 32px; font-size: 1rem; background: rgba(255,255,255,0.1);">
                        {% if item.type == 'cash' %}üíµ{% else %}üí≥{% endif %}
                    </div>
                    <span class="ms-2 fw-bold small">{{ item.get_type_display }}</span>
                </div>
                <div class="fs-4 fw-bold text-white">
                    {{ item.balance|floatformat:0 }} ‚Ç¥
                </div>
            </div>
            {% endfor %}
            
            <button type="button" 
                    class="mini-asset-card d-flex align-items-center justify-content-center text-decoration-none border-0 w-100" 
                    style="min-height: 100px; cursor: pointer; opacity: 0.7;"
                    data-bs-toggle="modal" 
                    data-bs-target="#addBalanceItemModal">
                <span class="fs-1" style="color: var(--text-muted)">+</span>
            </button>
        </div>
    </div>

    <div class="d-flex justify-content-between align-items-end mb-3 mt-5">
        <h4 class="text-white m-0 fw-bold">–Ü—Å—Ç–æ—Ä—ñ—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π</h4>
        
        <div class="filter-tabs">
            <span class="active" data-filter="all">–í—Å—ñ</span>
            <span data-filter="expense">–í–∏—Ç—Ä–∞—Ç–∏</span>
            <span data-filter="income">–î–æ—Ö–æ–¥–∏</span>
        </div>
    </div>

    <div class="transactions-list">
        {% for tx in transactions %}
            {% with ui=tx.get_ui_meta %}
            <div class="transaction-row" data-type="{{ tx.type }}">
                
                <div class="tx-left">
                    <div class="tx-icon bg-{{ ui.color }}-subtle text-{{ ui.color }}">
                        {{ ui.icon }}
                    </div>
                    
                    <div class="tx-info">
                        <div class="text-white fw-bold">{{ tx.get_category_display }}</div>
                        
                        <div class="small" style="color: rgba(255, 255, 255, 0.6);">
                            {{ tx.created_at|date:"d.m H:i" }} ‚Ä¢ 
                            
                            {% if tx.type == 'transfer' %}
                                {{ tx.from_asset.get_type_display }} &rarr; {{ tx.to_asset.get_type_display }}
                            {% else %}
                                {{ tx.asset.get_type_display }}
                            {% endif %}

                            {% if tx.description %}
                                <span class="ms-1" style="color:gray">‚Äî {{ tx.description|truncatechars:30 }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="tx-right-section">
                    <div class="tx-amount {% if tx.type == 'income' %}text-success{% elif tx.type == 'transfer' %}text-info{% else %}text-white{% endif %}">
                        {% if tx.type == 'income' %}+
                        {% elif tx.type == 'expense' %}-
                        {% else %} {% endif %} 
                        {{ tx.amount|floatformat:2 }} ‚Ç¥
                    </div>

                    <div class="tx-actions">
                        
                        {% if tx.type != 'transfer' %}
                            <button type="button" 
                                    class="btn-glass-icon"
                                    style="width: 32px; height: 32px;"
                                    data-bs-toggle="modal" 
                                    data-bs-target="#editTransactionModal"
                                    data-id="{{ tx.pk }}"
                                    data-amount="{{ tx.amount|stringformat:'.2f' }}"
                                    data-description="{{ tx.description }}"
                                    data-type="{{ tx.type }}"
                                    data-category="{{ tx.category }}"
                                    data-date="{{ tx.created_at|date:'Y-m-d\TH:i' }}"
                                    title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏">
                                ‚úé
                            </button>
                        {% endif %}

                        {% if tx.type == 'transfer' %}
                            <form action="{% url 'transfer_delete' tx.pk %}" method="post" onsubmit="return confirm('–°–∫–∞—Å—É–≤–∞—Ç–∏ —Ü–µ–π –ø–µ—Ä–µ–∫–∞–∑? –ö–æ—à—Ç–∏ –ø–æ–≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Ä–∞—Ö—É–Ω–æ–∫.');" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn-glass-icon text-danger" style="width: 32px; height: 32px; border-color: rgba(239, 68, 68, 0.3);" title="–°–∫–∞—Å—É–≤–∞—Ç–∏ –ø–µ—Ä–µ–∫–∞–∑">‚úï</button>
                            </form>
                        {% else %}
                            <form action="{% url 'transaction_delete' tx.pk %}" method="post" onsubmit="return confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é?');" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn-glass-icon text-danger" style="width: 32px; height: 32px; border-color: rgba(239, 68, 68, 0.3);" title="–í–∏–¥–∞–ª–∏—Ç–∏">‚úï</button>
                            </form>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endwith %}
        {% empty %}
            <div class="text-center py-5 text-muted">
                <div class="fs-1 mb-3">üì≠</div>
                <p>–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –ø–æ–∫–∏ –Ω–µ–º–∞—î</p>
            </div>
        {% endfor %}
    </div>
</div>

<div class="modal fade" id="addTransactionModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-modal">
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title text-white">–ù–æ–≤–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{% url 'transaction_add' portfolio.id %}" method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label small">–¢–∏–ø –æ–ø–µ—Ä–∞—Ü—ñ—ó</label>
                        <select name="type" class="form-control-custom">
                            <option value="expense" selected>–í–∏—Ç—Ä–∞—Ç–∞</option>
                            <option value="income">–î–æ—Ö—ñ–¥</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small">–ó —è–∫–æ–≥–æ —Ä–∞—Ö—É–Ω–∫—É?</label>
                        <select name="asset_id" class="form-control-custom" required>
                            {% for asset in portfolio.items.all %}
                                <option value="{{ asset.id }}">
                                    {{ asset.get_type_display }} ({{ asset.balance|floatformat:0 }} ‚Ç¥)
                                </option>
                            {% empty %}
                                <option disabled>–°–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä—ñ—Ç—å —Ä–∞—Ö—É–Ω–æ–∫!</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                        <select name="category" class="form-control-custom">
                            <option value="food">–á–∂–∞ —Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–∏</option>
                            <option value="transport">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
                            <option value="entertainment">–†–æ–∑–≤–∞–≥–∏</option>
                            <option value="utilities">–ö–æ–º—É–Ω–∞–ª—å–Ω—ñ</option>
                            <option value="shopping">–®–æ–ø—ñ–Ω–≥</option>
                            <option value="apartment">–î—ñ–º</option>
                            <option value="transfer">–ü–µ—Ä–µ–∫–∞–∑</option>
                            <option value="salary">–ó–∞—Ä–ø–ª–∞—Ç–∞</option>
                            <option value="other">–Ü–Ω—à–µ</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small">–°—É–º–∞</label>
                        <input type="number" step="0.01" name="amount" class="form-control-custom" placeholder="0.00" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small">–î–∞—Ç–∞</label>
                        <input type="datetime-local" name="created_at" class="form-control-custom">
                    </div>
                    <div class="mb-3">
                        <label class="form-label small">–ö–æ–º–µ–Ω—Ç–∞—Ä</label>
                        <textarea name="description" rows="2" class="form-control-custom"></textarea>
                    </div>
                </div>
                <div class="modal-footer border-top-0">
                    <button type="button" class="btn btn-dashed w-auto" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" class="btn btn-primary">–î–æ–¥–∞—Ç–∏</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editTransactionModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-modal">
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title text-white">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" id="editTransactionForm">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label small">–¢–∏–ø –æ–ø–µ—Ä–∞—Ü—ñ—ó</label>
                        <select name="type" id="modal_type" class="form-control-custom">
                            <option value="expense">–í–∏—Ç—Ä–∞—Ç–∞</option>
                            <option value="income">–î–æ—Ö—ñ–¥</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                        <select name="category" id="modal_category" class="form-control-custom">
                            <option value="food">–á–∂–∞ —Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–∏</option>
                            <option value="transport">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
                            <option value="entertainment">–†–æ–∑–≤–∞–≥–∏</option>
                            <option value="utilities">–ö–æ–º—É–Ω–∞–ª—å–Ω—ñ</option>
                            <option value="shopping">–®–æ–ø—ñ–Ω–≥</option>
                            <option value="apartment">–î—ñ–º</option>
                            <option value="transfer">–ü–µ—Ä–µ–∫–∞–∑</option>
                            <option value="salary">–ó–∞—Ä–ø–ª–∞—Ç–∞</option>
                            <option value="other">–Ü–Ω—à–µ</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small">–°—É–º–∞</label>
                        <input type="number" step="0.01" name="amount" id="modal_amount" class="form-control-custom" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small">–î–∞—Ç–∞</label>
                        <input type="datetime-local" name="created_at" id="modal_date" class="form-control-custom">
                    </div>
                    <div class="mb-3">
                        <label class="form-label small">–ö–æ–º–µ–Ω—Ç–∞—Ä</label>
                        <textarea name="description" id="modal_description" rows="2" class="form-control-custom"></textarea>
                    </div>
                </div>
                <div class="modal-footer border-top-0">
                    <button type="button" class="btn btn-dashed w-auto" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" class="btn btn-primary">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editPortfolioModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-modal">
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title text-white">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ—Ä—Ç—Ñ–æ–ª—ñ–æ</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{% url 'portfolio_update' portfolio.id %}" method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label small">–ù–∞–∑–≤–∞ –ø–æ—Ä—Ç—Ñ–æ–ª—ñ–æ</label>
                        <input type="text" name="name" class="form-control-custom" value="{{ portfolio.name }}" required>
                    </div>
                </div>
                <div class="modal-footer border-top-0">
                    <button type="button" class="btn btn-dashed w-auto" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" class="btn btn-primary">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="addBalanceItemModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-modal">
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title text-white">–î–æ–¥–∞—Ç–∏ —Ä–∞—Ö—É–Ω–æ–∫</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{% url 'balance_item_add' portfolio.id %}" method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label small">–¢–∏–ø —Ä–∞—Ö—É–Ω–∫—É</label>
                        <select name="type" class="form-control-custom">
                            <option value="bank" {% if "bank" in existing_types %}disabled{% endif %}>
                                –ë–∞–Ω–∫—ñ–≤—Å—å–∫–∏–π —Ä–∞—Ö—É–Ω–æ–∫ (–ö–∞—Ä—Ç–∫–∞) {% if "bank" in existing_types %}(–í–∂–µ —î){% endif %}
                            </option>
                            <option value="cash" {% if "cash" in existing_types %}disabled{% endif %}>
                                –ì–æ—Ç—ñ–≤–∫–∞ {% if "cash" in existing_types %}(–í–∂–µ —î){% endif %}
                            </option>
                        </select>
                        {% if "bank" in existing_types and "cash" in existing_types %}
                            <div class="text-danger small mt-1">–í–∏ —Å—Ç–≤–æ—Ä–∏–ª–∏ –≤—Å—ñ –º–æ–∂–ª–∏–≤—ñ —Ç–∏–ø–∏ —Ä–∞—Ö—É–Ω–∫—ñ–≤.</div>
                        {% endif %}
                    </div>
                    <div class="mb-3">
                        <label class="form-label small">–ü–æ—á–∞—Ç–∫–æ–≤–∏–π –±–∞–ª–∞–Ω—Å</label>
                        <input type="number" step="0.01" name="balance" class="form-control-custom" placeholder="0.00" value="0">
                    </div>
                </div>
                <div class="modal-footer border-top-0">
                    <button type="button" class="btn btn-dashed w-auto" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" class="btn btn-primary">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="addTransferModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-modal">
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title text-white">–ü–µ—Ä–µ–∫–∞–∑ –∫–æ—à—Ç—ñ–≤</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <form action="{% url 'transfer_add' portfolio.id %}" method="post">
                {% csrf_token %}
                <div class="modal-body">
                    
                    <div class="mb-3">
                        <label class="form-label small" style="color:lightgray">–ó–≤—ñ–¥–∫–∏ (–ü–æ—Ç–æ—á–Ω–µ –ø–æ—Ä—Ç—Ñ–æ–ª—ñ–æ)</label>
                        <select name="from_asset" class="form-control-custom" required>
                            {% for asset in portfolio.items.all %}
                                <option value="{{ asset.id }}">
                                    {{ asset.get_type_display }} ({{ asset.balance|floatformat:0 }} ‚Ç¥)
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label small" style="color:lightgray">–ö—É–¥–∏ (–ë—É–¥—å-—è–∫–µ –ø–æ—Ä—Ç—Ñ–æ–ª—ñ–æ)</label>
                        <select name="to_asset" class="form-control-custom" required>
                            {% for u_portfolio in user_portfolios %}
                                <optgroup label="{{ u_portfolio.name }}" style="color: #3b82f6; background: #0f172a;">
                                    {% for asset in u_portfolio.items.all %}
                                        <option value="{{ asset.id }}" style="color: white;">
                                            {{ asset.get_type_display }} 
                                            {% if u_portfolio.id == portfolio.id %}(–ü–æ—Ç–æ—á–Ω–µ){% endif %}
                                        </option>
                                    {% endfor %}
                                </optgroup>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label small" style="color:lightgray">–°—É–º–∞ –ø–µ—Ä–µ–∫–∞–∑—É</label>
                        <input type="number" step="0.01" name="amount" class="form-control-custom" placeholder="0.00" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label small" style="color:lightgray">–î–∞—Ç–∞</label>
                        <input type="datetime-local" name="created_at" class="form-control-custom">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label small" style="color:lightgray">–ö–æ–º–µ–Ω—Ç–∞—Ä</label>
                        <textarea name="description" rows="2" class="form-control-custom"></textarea>
                    </div>

                </div>
                <div class="modal-footer border-top-0">
                    <button type="button" class="btn btn-dashed w-auto" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" class="btn btn-primary">–ü–µ—Ä–µ–∫–∞–∑–∞—Ç–∏</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editTransferModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-modal">
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title text-white">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø–µ—Ä–µ–∫–∞–∑</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <form method="post" id="editTransferForm">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row">
                        <div class="col-6 mb-3">
                            <label class="form-label small">–ó —Ä–∞—Ö—É–Ω–∫—É</label>
                            <select name="from_asset" id="edit_transfer_from" class="form-control-custom" required>
                                {% for asset in portfolio.items.all %}
                                    <option value="{{ asset.id }}">{{ asset.get_type_display }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-6 mb-3">
                            <label class="form-label small">–ù–∞ —Ä–∞—Ö—É–Ω–æ–∫</label>
                            <select name="to_asset" id="edit_transfer_to" class="form-control-custom" required>
                                {% for asset in portfolio.items.all %}
                                    <option value="{{ asset.id }}">{{ asset.get_type_display }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small">–°—É–º–∞ –ø–µ—Ä–µ–∫–∞–∑—É</label>
                        <input type="number" step="0.01" name="amount" id="edit_transfer_amount" class="form-control-custom" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small">–î–∞—Ç–∞</label>
                        <input type="datetime-local" name="created_at" id="edit_transfer_date" class="form-control-custom">
                    </div>
                    <div class="mb-3">
                        <label class="form-label small">–ö–æ–º–µ–Ω—Ç–∞—Ä</label>
                        <textarea name="description" id="edit_transfer_desc" rows="2" class="form-control-custom"></textarea>
                    </div>
                </div>
                <div class="modal-footer border-top-0">
                    <button type="button" class="btn btn-dashed w-auto" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" class="btn btn-primary">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        
        // 1. –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –¢–†–ê–ù–ó–ê–ö–¶–Ü–ô
        const editTransactionModal = document.getElementById('editTransactionModal');
        if (editTransactionModal) {
            editTransactionModal.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;
                document.getElementById('modal_amount').value = button.getAttribute('data-amount').replace(',', '.');
                document.getElementById('modal_description').value = button.getAttribute('data-description');
                document.getElementById('modal_type').value = button.getAttribute('data-type');
                document.getElementById('modal_category').value = button.getAttribute('data-category');
                document.getElementById('modal_date').value = button.getAttribute('data-date');
                
                const id = button.getAttribute('data-id');
                document.getElementById('editTransactionForm').action = `/transaction/${id}/update/`;
            });
        }

        // 2. –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ü–ï–†–ï–ö–ê–ó–Ü–í
        const editTransferModal = document.getElementById('editTransferModal');
        if (editTransferModal) {
            editTransferModal.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;
                
                // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –ø–æ–ª—è –¥–∞–Ω–∏–º–∏
                document.getElementById('edit_transfer_amount').value = button.getAttribute('data-amount').replace(',', '.');
                document.getElementById('edit_transfer_desc').value = button.getAttribute('data-description');
                document.getElementById('edit_transfer_from').value = button.getAttribute('data-from');
                document.getElementById('edit_transfer_to').value = button.getAttribute('data-to');
                document.getElementById('edit_transfer_date').value = button.getAttribute('data-date');

                // –û–Ω–æ–≤–ª—é—î–º–æ Action URL —Ñ–æ—Ä–º–∏
                const id = button.getAttribute('data-id');
                // –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –≤ urls.py —à–ª—è—Ö —Å–∞–º–µ —Ç–∞–∫–∏–π
                document.getElementById('editTransferForm').action = `/transfer/${id}/update/`;
            });
        }

        // 3. –§—ñ–ª—å—Ç—Ä–∏ (–í—Å—ñ/–í–∏—Ç—Ä–∞—Ç–∏/–î–æ—Ö–æ–¥–∏)
        const tabs = document.querySelectorAll('.filter-tabs span');
        const rows = document.querySelectorAll('.transaction-row');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const filterValue = tab.getAttribute('data-filter');
                rows.forEach(row => {
                    const rowType = row.getAttribute('data-type');
                    // –î–ª—è –ø–µ—Ä–µ–∫–∞–∑—ñ–≤ (type='transfer') –ø–æ–∫–∞–∑—É—î–º–æ —ó—Ö –∑–∞–≤–∂–¥–∏ –∞–±–æ –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ "–í—Å—ñ"
                    if (filterValue === 'all' || filterValue === rowType) {
                        row.style.display = 'flex';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
        });
    });
</script>
{% endblock %}